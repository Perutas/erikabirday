<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Feliz Cumple, Erika ðŸŽ‚</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #0b0b0e;
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.72);
      --shadow: 0 18px 60px rgba(0,0,0,.55);

      --polaroid: #f5f0e6;
      --polaroidStroke: rgba(0,0,0,.10);
      --polaroidShadow: 0 18px 45px rgba(0,0,0,.48);

      --radius: 22px;

      /* Fondo suave */
      --bgBlur: 30px;
      --bgSaturate: .92;
      --bgBrightness: .60;
      --bgOpacity: .92;

      /* Pattern */
      --patternOpacity: .10;
      --patternBlur: .35px;
      --patternSaturate: 1.12;
      --patternBrightness: 1.04;

      --maskInner: 260px;
      --maskOuter: 460px;

      --dot1: #ff4d6d;
      --dot2: #ffd166;
      --dot3: #4cc9f0;
      --dot4: #b8f2a3;
      --dot5: #c77dff;

      --svg-frame: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 120 120'%3E%3Cg fill='none' stroke='%23b05cff' stroke-width='5' stroke-linecap='round'%3E%3Crect x='28' y='28' width='64' height='64' rx='12'/%3E%3Crect x='36' y='36' width='48' height='48' rx='10' stroke='%23ffd166' stroke-width='2' opacity='.65'/%3E%3Cpath d='M28 44c-11-4-11-18 0-22'/%3E%3Cpath d='M92 44c11-4 11-18 0-22'/%3E%3Cpath d='M28 76c-11 4-11 18 0 22'/%3E%3Cpath d='M92 76c11 4 11 18 0 22'/%3E%3C/g%3E%3Cg fill='%23b05cff' opacity='.22'%3E%3Ccircle cx='22' cy='60' r='3'/%3E%3Ccircle cx='98' cy='60' r='3'/%3E%3Ccircle cx='60' cy='22' r='3'/%3E%3Ccircle cx='60' cy='98' r='3'/%3E%3C/g%3E%3C/svg%3E");
      --svg-umbrella: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 140 140'%3E%3Cg fill='none' stroke-width='5' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M20 72 Q70 22 120 72' stroke='%23ffd166'/%3E%3Cpath d='M20 72 Q38 58 52 72 Q70 58 88 72 Q102 58 120 72' stroke='%23ff4d6d'/%3E%3Cpath d='M70 72 v40 q0 12 12 12 q10 0 10-10' stroke='%234cc9f0'/%3E%3Cpath d='M70 52 v20' stroke='%23ffffff' opacity='.65'/%3E%3C/g%3E%3Ccircle cx='34' cy='86' r='3' fill='%23b8f2a3' opacity='.85'/%3E%3Ccircle cx='106' cy='86' r='3' fill='%23c77dff' opacity='.85'/%3E%3C/svg%3E");
      --svg-couch: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 160 120'%3E%3Cg fill='none' stroke='%23ff4d6d' stroke-width='5' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M28 70 q0-18 18-18 h68 q18 0 18 18 v22 H28z'/%3E%3Cpath d='M28 70 h-8 q-8 0-8 8 v12 q0 8 8 8 h8' stroke='%23ffd166'/%3E%3Cpath d='M132 70 h8 q8 0 8 8 v12 q0 8-8 8 h-8' stroke='%23ffd166'/%3E%3Cpath d='M52 52 v-10 q0-10 10-10 h36 q10 0 10 10 v10' stroke='%234cc9f0'/%3E%3Cpath d='M52 92 v10 M108 92 v10' stroke='%23ffffff' opacity='.65'/%3E%3C/g%3E%3C/svg%3E");
      --svg-fountain: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 160 160'%3E%3Cg fill='none' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M40 116 q40 24 80 0' stroke='%23b8f2a3' stroke-width='6'/%3E%3Cpath d='M52 106 q28 18 56 0' stroke='%234cc9f0' stroke-width='6'/%3E%3Cpath d='M80 44 q-22 22-22 46' stroke='%234cc9f0' stroke-width='6'/%3E%3Cpath d='M80 44 q22 22 22 46' stroke='%23c77dff' stroke-width='6'/%3E%3Cpath d='M80 44 q0 26 0 46' stroke='%23ffd166' stroke-width='6'/%3E%3Ccircle cx='58' cy='88' r='4' fill='%234cc9f0' opacity='.95'/%3E%3Ccircle cx='102' cy='88' r='4' fill='%23c77dff' opacity='.95'/%3E%3Ccircle cx='80' cy='92' r='4' fill='%23ffd166' opacity='.95'/%3E%3C/g%3E%3C/svg%3E");
      --svg-coffee: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 160 160'%3E%3Cg fill='none' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M52 70 h56 v34 q0 16-16 16 H68 q-16 0-16-16z' stroke='%23b8f2a3' stroke-width='6'/%3E%3Cpath d='M108 78 h10 q12 0 12 12 q0 12-12 12 h-10' stroke='%23ffd166' stroke-width='6'/%3E%3Cpath d='M66 54 q-8-10 0-20' stroke='%23ffffff' stroke-width='5' opacity='.7'/%3E%3Cpath d='M80 54 q-8-10 0-20' stroke='%23ffffff' stroke-width='5' opacity='.7'/%3E%3Cpath d='M94 54 q-8-10 0-20' stroke='%23ffffff' stroke-width='5' opacity='.7'/%3E%3C/g%3E%3Ccircle cx='80' cy='132' r='5' fill='%23b05cff' opacity='.75'/%3E%3C/svg%3E");
      --svg-ears: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 120 120'%3E%3Cg fill='%23ffffff' opacity='.78'%3E%3Ccircle cx='60' cy='70' r='22'/%3E%3Ccircle cx='38' cy='52' r='14'/%3E%3Ccircle cx='82' cy='52' r='14'/%3E%3C/g%3E%3C/svg%3E");
    }

    *{ box-sizing: border-box; }
    html,body{ height:100%; }

    body{
      margin:0;
      background: var(--bg);
      color: var(--text);
      font-family: "Fredoka", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overflow: hidden; /* Importante para que no haya scroll por las polaroids flotantes */
    }

    /* ===== INTRO LAYER ===== */
    #introLayer {
      position: fixed;
      inset: 0;
      z-index: 9999;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: opacity 0.8s ease, visibility 0.8s;
    }
    #introVideo {
      width: 100%;
      height: 100%;
      object-fit: contain; /* o 'cover' si prefieres que llene todo sin bordes negros */
    }
    #enterBtn {
      position: absolute;
      top: 80%; /* Un poco mÃ¡s abajo */
      left: 50%;
      transform: translate(-50%, -50%) scale(0.9);
      padding: 16px 32px;
      font-size: clamp(18px, 5vw, 24px);
      font-weight: bold;
      background: #ff4d6d;
      color: white;
      border: none;
      border-radius: 50px;
      box-shadow: 0 10px 40px rgba(255, 77, 109, 0.6);
      cursor: pointer;
      opacity: 0;
      pointer-events: none;
      transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      font-family: "Luckiest Guy", cursive;
      letter-spacing: 1px;
      white-space: nowrap;
    }
    #enterBtn.visible {
      opacity: 1;
      pointer-events: auto;
      transform: translate(-50%, -50%) scale(1);
    }
    #enterBtn:hover {
      transform: translate(-50%, -50%) scale(1.1);
      background: #ff758f;
    }
    #enterBtn:active {
      transform: translate(-50%, -50%) scale(0.95);
    }


    /* ===== BG ===== */
    .bg{
      position: fixed; inset:0;
      z-index: 0;
      overflow: hidden;
      background:#000;
    }
    .bg::before{
      content:"";
      position:absolute; inset:-40px;
      /* Se llenarÃ¡ vÃ­a JS para que coincida con la imagen principal */
      background-position: center;
      background-size: cover;
      background-repeat: no-repeat;
      filter: blur(var(--bgBlur)) saturate(var(--bgSaturate)) brightness(var(--bgBrightness));
      transform: scale(1.18);
      opacity: var(--bgOpacity);
      transition: background-image 0.5s ease;
    }
    .bg::after{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(1100px 640px at 50% 14%, rgba(0,0,0,.30), rgba(0,0,0,.80)),
        radial-gradient(900px 700px at 20% 86%, rgba(0,0,0,.20), rgba(0,0,0,.86)),
        radial-gradient(900px 700px at 90% 78%, rgba(0,0,0,.20), rgba(0,0,0,.88));
      pointer-events:none;
    }

    /* ===== Decor ===== */
    .decor{
      position: fixed; inset:0;
      z-index: 1;
      pointer-events:none;
      overflow:hidden;
    }
    .pattern{
      position:absolute; inset:-40px;
      opacity: var(--patternOpacity);
      filter: blur(var(--patternBlur)) saturate(var(--patternSaturate)) brightness(var(--patternBrightness));
      mix-blend-mode: screen;
      background-image:
        var(--svg-frame),
        var(--svg-umbrella),
        var(--svg-couch),
        var(--svg-fountain),
        var(--svg-coffee),
        var(--svg-ears);
      background-repeat: repeat;
      background-size:
        280px 280px,
        300px 300px,
        320px 320px,
        360px 360px,
        340px 340px,
        320px 320px;
      background-position:
        0 0,
        120px 80px,
        60px 190px,
        210px 140px,
        90px 20px,
        240px 70px;
      transform: rotate(-4deg) scale(1.06);
      -webkit-mask-image: radial-gradient(circle at 50% 50%,
        transparent 0,
        transparent var(--maskInner),
        #000 var(--maskOuter),
        #000 100%);
      mask-image: radial-gradient(circle at 50% 50%,
        transparent 0,
        transparent var(--maskInner),
        #000 var(--maskOuter),
        #000 100%);
    }

    /* ===== Header ===== */
    .titleWrap{
      position: fixed;
      left: 0; right: 0;
      top: 0;
      z-index: 10;
      padding: calc(14px + env(safe-area-inset-top)) 14px 8px;
      display:flex;
      justify-content:center;
      pointer-events:none;
    }
    .titleCard{
      width: min(920px, 96vw);
      border-radius: 999px;
      padding: 10px 14px;
      background: rgba(0,0,0,.30);
      border: 1px solid rgba(255,255,255,.10);
      backdrop-filter: blur(10px);
      box-shadow: 0 18px 60px rgba(0,0,0,.45);
      text-align:center;
    }
    h1{
      margin:0;
      font-family: "Luckiest Guy", system-ui, sans-serif;
      letter-spacing: 1px;
      font-size: clamp(26px, 4.2vw, 46px);
      line-height: 1.0;
      text-shadow: 0 10px 34px rgba(0,0,0,.60);
      color: #fff;
    }
    .sub{
      margin-top: 6px;
      font-weight: 800;
      font-size: clamp(12px, 2.2vw, 14px);
      color: rgba(255,255,255,.78);
    }

    /* ===== HERO ===== */
    .hero{
      position: fixed;
      inset: 0;
      z-index: 9;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:
        calc(82px + env(safe-area-inset-top))
        16px
        calc(18px + env(safe-area-inset-bottom));
      pointer-events:none;
    }

    /* MAIN CARD */
    .mainCard{
      pointer-events:auto;
      /* portrait por defecto */
      height: min(70vh, 760px);
      aspect-ratio: 4 / 5;
      
      max-width: 92vw;
      width: auto;

      border-radius: 22px;
      overflow:hidden;
      position:relative;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      box-shadow: var(--shadow);
      transform: translateZ(0);
      transition: transform 0.3s ease;
      z-index: 9;
    }

    /* relleno blur interno */
    .mainCard::before{
      content:"";
      position:absolute; inset:-24px;
      /* Se llenarÃ¡ vÃ­a JS */
      background-position: center;
      background-size: cover;
      filter: blur(16px) saturate(1.05) brightness(.75);
      transform: scale(1.10);
      opacity: .55;
      z-index: 0;
      transition: background-image 0.5s ease;
    }

    .mainImage{
      position: relative;
      z-index: 1;
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: 50% 50%;
      background: rgba(0,0,0,.20);
      display:block;
      cursor: pointer; /* Indicar que se puede abrir */
    }

    /* NavegaciÃ³n Carrusel */
    .navBtn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      z-index: 1002; /* Muy alto para que funcione incluso con polaroids encima */
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(255,255,255,0.2);
      color: white;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 20px;
      transition: all 0.2s;
      backdrop-filter: blur(4px);
    }
    .navBtn:hover {
      background: rgba(255, 77, 109, 0.8);
      transform: translateY(-50%) scale(1.1);
    }
    .navBtn.prev { left: 10px; }
    .navBtn.next { right: 10px; }


    .captionBar{
      position:absolute;
      left: 12px;
      right: 12px;
      bottom: 12px;
      z-index: 2;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      padding: 10px 12px;
      border-radius: 16px;
      background: rgba(0,0,0,.46);
      border: 1px solid rgba(255,255,255,.12);
      backdrop-filter: blur(10px);
    }
    .capLeft{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width:0;
    }
    .tag{
      font-weight: 900;
      letter-spacing: .5px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.10);
      font-size: 12px;
      flex: 0 0 auto;
    }
    .capText{
      font-weight: 900;
      color: rgba(255,255,255,.92);
      font-size: 13px;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .dots{ display:flex; gap:6px; align-items:center; }
    .dot{ width:8px; height:8px; border-radius:999px; opacity:.95; }
    .dot.c1{ background: var(--dot1); }
    .dot.c2{ background: var(--dot2); }
    .dot.c3{ background: var(--dot3); }
    .dot.c4{ background: var(--dot4); }
    .dot.c5{ background: var(--dot5); }

    /* ===== Polaroids ===== */
    .polaroids{
      position: fixed;
      inset: 0;
      z-index: 7; /* Debajo de Main Card (9) pero encima de BG */
      pointer-events:none;
    }

    .polaroid{
      pointer-events:auto;
      position:absolute;
      left: 50%;
      top: 50%;
      width: clamp(132px, 18vw, 230px);
      border-radius: 12px;
      background: var(--polaroid);
      border: 1px solid var(--polaroidStroke);
      box-shadow: var(--polaroidShadow);
      padding: 10px 10px 16px;
      transform: translate(-50%,-50%) scale(.62) rotate(0deg);
      opacity: 0;
      cursor: pointer;
      transform-origin: 50% 70%;
      outline: none;
      will-change: transform, left, top, opacity;
      -webkit-tap-highlight-color: transparent;
      transition: z-index 0s;
    }
    .polaroid img{
      display:block;
      width: 100%;
      aspect-ratio: 4 / 3;
      object-fit: cover;
      border-radius: 8px;
      background: rgba(0,0,0,.08);
      border: 1px solid rgba(0,0,0,.08);
    }
    .polaroid .label{
      margin-top: 10px;
      font-weight: 900;
      color: rgba(0,0,0,.72);
      font-size: 12px;
      letter-spacing: .2px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 8px;
    }
    .polaroid .label small{ font-weight: 900; opacity:.75; }

    .polaroid.show{
      animation:
        popIn 880ms cubic-bezier(.2,.9,.2,1) var(--delay, 0ms) forwards,
        floaty var(--floatDur, 5.6s) ease-in-out calc(var(--delay, 0ms) + 880ms) infinite;
    }

    @keyframes popIn{
      0%{
        left: 50%;
        top: 50%;
        transform: translate(-50%,-50%) scale(.58) rotate(0deg);
        opacity: 0;
        filter: blur(1px);
      }
      55%{ opacity:1; filter: blur(0); }
      100%{
        left: var(--left);
        top: var(--top);
        transform: translate(-50%,-50%) scale(1) rotate(var(--rot));
        opacity: 1;
      }
    }
    @keyframes floaty{
      0%,100%{ transform: translate(-50%,-50%) scale(1) rotate(var(--rot)); }
      50%{ transform: translate(-50%,-52%) scale(1.02) rotate(calc(var(--rot) * .88)); }
    }

    /* Hover: Sube el z-index para que tape incluso a la Main Card si pasa por encima */
    .polaroid:hover{
      z-index: 999 !important;
      transform: translate(-50%,-50%) scale(1.08) rotate(0deg) !important;
      box-shadow: 0 26px 70px rgba(0,0,0,.62);
      transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      animation-play-state: paused;
    }
    .polaroid:active{
      transform: translate(-50%,-50%) scale(1.04) rotate(0deg) !important;
    }

    /* ===== Lightbox ===== */
    .lightbox{
      position: fixed; inset: 0;
      z-index: 20;
      display:none;
      align-items:center;
      justify-content:center;
      padding: calc(16px + env(safe-area-inset-top)) 16px calc(16px + env(safe-area-inset-bottom));
      background: rgba(0,0,0,.74);
      backdrop-filter: blur(7px);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .lightbox.show{ display:flex; opacity: 1; }
    
    .lightboxCard{
      width: min(980px, 96vw);
      border-radius: 18px;
      overflow:hidden;
      background: rgba(20,20,24,.82);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 24px 80px rgba(0,0,0,.75);
      position:relative;
      transform: scale(0.95);
      transition: transform 0.3s ease;
    }
    .lightbox.show .lightboxCard { transform: scale(1); }

    .lightboxCard img{
      width: 100%;
      display:block;
      max-height: 78vh;
      object-fit: contain;
      background: rgba(0,0,0,.35);
    }
    .lightboxTop{
      position:absolute;
      top: 10px; left: 10px; right: 10px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 10px;
    }
    .lbPill{
      padding: 9px 12px;
      border-radius: 999px;
      background: rgba(0,0,0,.55);
      border: 1px solid rgba(255,255,255,.14);
      color: rgba(255,255,255,.92);
      font-weight: 900;
      letter-spacing: .2px;
      font-size: 13px;
      backdrop-filter: blur(10px);
      box-shadow: 0 16px 40px rgba(0,0,0,.55);
    }
    .lbClose{
      cursor:pointer;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(0,0,0,.62);
      border: 1px solid rgba(255,255,255,.14);
      color: rgba(255,255,255,.92);
      font-weight: 900;
      letter-spacing: .2px;
      backdrop-filter: blur(10px);
      transition: background 0.2s;
    }
    .lbClose:hover { background: rgba(0,0,0,.8); }

    /* ===== Music Control ===== */
    .musicCtrl{
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 100;
        background: rgba(0,0,0,0.6);
        border: 1px solid rgba(255,255,255,0.2);
        color: white;
        padding: 10px 14px;
        border-radius: 30px;
        cursor: pointer;
        font-size: 18px;
        display: flex;
        align-items: center;
        gap: 8px;
        backdrop-filter: blur(5px);
        transition: transform 0.2s;
    }
    .musicCtrl:active{ transform: scale(0.95); }
    .musicCtrl span { font-size: 12px; font-weight: 700; }

    @media (max-width: 620px){
      :root{
        --maskInner: 230px;
        --maskOuter: 390px;
        --patternOpacity: .095;
      }
      .titleCard{ padding: 9px 12px; }

      /* Responsive en mÃ³vil: mÃ¡s pequeÃ±a para dar espacio a las polaroids */
      .mainCard{
        height: min(55vh, 500px); /* Antes era 64vh, reducido para espacio */
        aspect-ratio: 4 / 5;
        max-width: 85vw; /* Margen horizontal mÃ¡s amplio */
      }
      
      /* Polaroids mÃ¡s pequeÃ±as en mÃ³vil */
      .polaroid{
        width: clamp(100px, 28vw, 140px);
        padding: 6px 6px 10px;
      }
      .polaroid .label{
          font-size: 10px;
          margin-top: 6px;
      }
      
      /* CAMBIO CLAVE: Las polaroids ahora flotan ENCIMA de la tarjeta principal en mÃ³vil */
      .polaroids {
          z-index: 11; /* Mayor que mainCard (9) y titleWrap (10) */
      }
      
      /* Control de mÃºsica mÃ¡s pequeÃ±o */
      .musicCtrl{
          bottom: 10px;
          left: 10px;
          padding: 8px 12px;
      }
    }

    @media (prefers-reduced-motion: reduce){
      .polaroid.show{ animation:none; opacity:1; }
    }
  </style>
</head>

<body>
  <!-- INTRO LAYER -->
  <div id="introLayer">
    <!-- El video de intro. Usa playsinline para que funcione bien en iOS/Android -->
    <video id="introVideo" playsinline>
        <source src="intro.mp4" type="video/mp4">
        <!-- Si el video no carga, se mostrarÃ¡ el botÃ³n de todas formas -->
    </video>
    <button id="enterBtn">Â¡ApachÃºrrame aquÃ­! ðŸ‘†</button>
  </div>

  <div class="bg" id="bgLayer" aria-hidden="true"></div>

  <div class="decor" aria-hidden="true">
    <div class="pattern"></div>
  </div>

  <div class="titleWrap" aria-hidden="true">
    <div class="titleCard">
      <h1>FELIZ CUMPLEAÃ‘OS, ERIKA ðŸŽ‚</h1>
      <div class="sub">Te queremos un montÃ³n ðŸ’› (toca una foto)</div>
    </div>
  </div>

  <!-- Music Toggle Button -->
  <button class="musicCtrl" id="musicBtn" aria-label="Controlar mÃºsica">
      <div id="musicIcon">ðŸ”‡</div>
      <span id="musicText">MÃºsica</span>
  </button>
  
  <!-- Audio Elements -->
  <!-- 'musica.mp3' debe ser la canciÃ³n de fondo -->
  <audio id="bgMusic" loop>
      <source src="musica.mp3" type="audio/mp3">
  </audio>
  <!-- 'click.mp3' debe ser un sonido corto tipo pop o campana -->
  <audio id="clickSound">
      <source src="click.mp3" type="audio/mp3">
  </audio>

  <div class="hero" aria-hidden="true">
    <div class="mainCard" id="mainCard">
      <!-- Botones del Carrusel -->
      <button class="navBtn prev" id="prevBtn" aria-label="Anterior">â€¹</button>
      <button class="navBtn next" id="nextBtn" aria-label="Siguiente">â€º</button>

      <!-- Se llenarÃ¡ con JS dependiendo del modo (Demo o Local) -->
      <img class="mainImage" id="mainImageEl" src="" alt="Foto principal de Erika" decoding="async" />
      <div class="captionBar">
        <div class="capLeft">
          <div class="tag">ERIKA</div>
          <div class="capText" id="mainCaption">Â¡Feliz vuelta al sol! ðŸ¥³</div>
        </div>
        <div class="dots" aria-hidden="true">
          <span class="dot c1"></span><span class="dot c2"></span><span class="dot c3"></span>
        </div>
      </div>
    </div>
  </div>

  <div class="polaroids" id="polaroids" aria-label="GalerÃ­a de fotos flotantes"></div>

  <div class="lightbox" id="lightbox" aria-hidden="true">
    <div class="lightboxCard" role="dialog" aria-modal="true" aria-label="Vista ampliada">
      <div class="lightboxTop">
        <div class="lbPill" id="lbTitle">Foto</div>
        <button class="lbClose" id="lbCloseBtn" type="button">âœ• Cerrar</button>
      </div>
      <img id="lbImg" src="" alt="Foto ampliada" decoding="async" />
    </div>
  </div>

  <script>
    // ===============================================
    // CONFIGURACIÃ“N DE IMÃGENES
    // ===============================================
    
    // CAMBIA ESTO A 'false' CUANDO TENGAS TUS PROPIAS FOTOS (1.jpeg ... 12.jpeg)
    const USE_DEMO_IMAGES = false; 

    // ConfiguraciÃ³n Local
    const TOTAL_LOCAL = 12; // Cantidad de fotos si usas tus archivos
    const MAIN_BG_NUM = 8;  // El nÃºmero de la foto principal (ej: 8.jpeg) - SerÃ¡ el inicio del carrusel
    const IMG_EXT = "jpeg";

    // URLs de Demo (Se ignoran si USE_DEMO_IMAGES = false)
    const DEMO_MAIN = "https://images.unsplash.com/photo-1494790108377-be9c29b29330?q=80&w=1000&auto=format&fit=crop";
    const DEMO_PICS = [
      "https://images.unsplash.com/photo-1530103862676-de3c9da59af7?auto=format&fit=crop&w=500&q=80",
      "https://images.unsplash.com/photo-1527529482837-4698179dc6ce?auto=format&fit=crop&w=500&q=80",
      "https://images.unsplash.com/photo-1513151233558-d860c5398176?auto=format&fit=crop&w=500&q=80",
      "https://images.unsplash.com/photo-1561484930-998b6a7b22e8?auto=format&fit=crop&w=500&q=80",
      "https://images.unsplash.com/photo-1532635241-17e820acc59f?auto=format&fit=crop&w=500&q=80",
      "https://images.unsplash.com/photo-1481819613568-3701cbc70156?auto=format&fit=crop&w=500&q=80",
      "https://images.unsplash.com/photo-1525268771113-32d9e9021a97?auto=format&fit=crop&w=500&q=80",
      "https://images.unsplash.com/photo-1514525253440-b393452e8d26?auto=format&fit=crop&w=500&q=80",
      "https://images.unsplash.com/photo-1464349153735-7db50ed83c84?auto=format&fit=crop&w=500&q=80",
      "https://images.unsplash.com/photo-1519834785169-98be25ec3f84?auto=format&fit=crop&w=500&q=80",
      "https://images.unsplash.com/photo-1523301343968-6324833f1967?auto=format&fit=crop&w=500&q=80",
      "https://images.unsplash.com/photo-1502630859934-b3b41d18206c?auto=format&fit=crop&w=500&q=80"
    ];

    const greetings = [
      "Â¡Feliz cumple! ðŸŽ‚", "Â¡Brilla hoy! âœ¨", "Â¡Te queremos! ðŸ’›",
      "Â¡SonrÃ­e siempre! ðŸ˜„", "Â¡A celebrar! ðŸ¥³", "Â¡Que sea hermoso! ðŸŒŸ",
      "Â¡Abrazo gigante! ðŸ¤—", "Â¡Eres lo mÃ¡ximo! ðŸ«¶", "Â¡Full buenas vibras! ðŸŒˆ",
      "Â¡Feliz dÃ­a! ðŸŽ‰", "Â¡Mucho amor! ðŸ’–", "Â¡Hoy es tu dÃ­a! ðŸ‘‘",
    ];

    const polaroidsEl = document.getElementById("polaroids");
    const lightbox = document.getElementById("lightbox");
    const lbImg = document.getElementById("lbImg");
    const lbTitle = document.getElementById("lbTitle");
    const lbCloseBtn = document.getElementById("lbCloseBtn");
    const mainImageEl = document.getElementById("mainImageEl");
    const mainCaption = document.getElementById("mainCaption");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const bgLayer = document.getElementById("bgLayer");
    
    // Audio Elements
    const bgMusic = document.getElementById("bgMusic");
    const clickSound = document.getElementById("clickSound");
    const musicBtn = document.getElementById("musicBtn");
    const musicIcon = document.getElementById("musicIcon");
    const musicText = document.getElementById("musicText");
    let isMusicPlaying = false;
    let userInteracted = false;

    // Volumen inicial (suave)
    bgMusic.volume = 0.4;
    clickSound.volume = 0.6;

    // --- CAROUSEL LOGIC ---
    let currentIndex = 0;
    let imageList = []; // Array of objects {src, msg}

    function initImageList() {
        if (USE_DEMO_IMAGES) {
            // Add main demo
            imageList.push({ src: DEMO_MAIN, msg: "Â¡Feliz vuelta al sol! ðŸ¥³" });
            // Add other demos
            DEMO_PICS.forEach((url, i) => {
                imageList.push({ src: url, msg: greetings[i % greetings.length] });
            });
        } else {
            // Local files: 1 to TOTAL_LOCAL
            // We want the MAIN_BG_NUM to be first
            imageList.push({ 
                src: `${MAIN_BG_NUM}.${IMG_EXT}`, 
                msg: "Â¡Feliz vuelta al sol! ðŸ¥³" 
            });
            for (let i = 1; i <= TOTAL_LOCAL; i++) {
                if (i !== MAIN_BG_NUM) {
                    imageList.push({ 
                        src: `${i}.${IMG_EXT}`, 
                        msg: greetings[(i-1) % greetings.length] 
                    });
                }
            }
        }
    }

    function updateCarousel(index) {
        if (index < 0) index = imageList.length - 1;
        if (index >= imageList.length) index = 0;
        currentIndex = index;

        const item = imageList[currentIndex];
        
        // Update Main Image
        mainImageEl.style.opacity = '0';
        setTimeout(() => {
            mainImageEl.src = item.src;
            mainCaption.textContent = item.msg;
            mainImageEl.style.opacity = '1';
        }, 150); // Small fade effect

        // Update BG Blur
        // We need to inject style again or update the stylesheet
        const bgStyle = document.getElementById('dynamicBgStyle');
        if(bgStyle) {
            bgStyle.innerHTML = `
                .bg::before { background-image: url("${item.src}"); }
                .mainCard::before { background-image: url("${item.src}"); }
            `;
        }
    }

    prevBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        playClickSound();
        updateCarousel(currentIndex - 1);
    });

    nextBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        playClickSound();
        updateCarousel(currentIndex + 1);
    });

    // Clicking main image opens lightbox (full screen detail)
    mainImageEl.addEventListener('click', () => {
        openLightbox(imageList[currentIndex].src, imageList[currentIndex].msg);
    });


    function rand(min, max){ return Math.random() * (max - min) + min; }
    function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }

    function getImageUrl(indexOrId) {
      if (USE_DEMO_IMAGES) {
        if (indexOrId === 'main') return DEMO_MAIN;
        return DEMO_PICS[indexOrId % DEMO_PICS.length];
      } else {
        return `${indexOrId}.${IMG_EXT}`;
      }
    }

    function setupMainImages() {
      // Initialize Image List for Carousel
      initImageList();
      
      // Setup initial styles
      const mainSrc = imageList[0].src;
      mainImageEl.src = mainSrc;
      
      const dynamicStyles = document.createElement('style');
      dynamicStyles.id = 'dynamicBgStyle';
      dynamicStyles.innerHTML = `
        .bg::before { background-image: url("${mainSrc}"); }
        .mainCard::before { background-image: url("${mainSrc}"); }
      `;
      document.head.appendChild(dynamicStyles);
    }

    function generateRingSlots(count){
      const w = window.innerWidth;
      const h = window.innerHeight;
      const isMobile = w < 620;

      const main = document.getElementById("mainCard");
      const header = document.querySelector(".titleWrap");

      // Dimensiones de seguridad
      const rect = main
        ? main.getBoundingClientRect()
        : { left: w*0.12, right: w*0.88, top: h*0.30, bottom: h*0.70, width: w*0.7, height: h*0.4 };

      const headRect = header ? header.getBoundingClientRect() : { bottom: 90 };

      // TamaÃ±o estimado de polaroid (ancho) + un poco de margen
      let polBase = isMobile ? 120 : 180;
      const polW = Math.min(Math.max(w * 0.18, polBase), 230);
      const polH = polW * 0.75 + 62;

      const marginX = polW/2 + 10;
      const marginTop = headRect.bottom + polH/2 + 10;
      const marginBottom = polH/2 + 10;

      // Ãrea de exclusiÃ³n
      const padScale = isMobile ? 0.05 : 0.55; 
      const pad = Math.max(polW, polH) * padScale;
      
      const ex = {
        x0: rect.left - pad,
        x1: rect.right + pad,
        y0: rect.top - pad,
        y1: rect.bottom + pad
      };

      const cx = (rect.left + rect.right) / 2;
      const cy = (rect.top + rect.bottom) / 2;

      // Distancia mÃ­nima de colisiÃ³n entre fotos para que no se tapen
      const minDist = isMobile ? 100 : 160;

      // Definir Ã¡rea de spawn
      const minR = Math.max(rect.width, rect.height) * (isMobile ? 0.3 : 0.55) + pad * 0.2;
      const maxR = Math.min(w, h) * 0.95;

      const slots = [];
      const step = (Math.PI * 2) / count;

      for (let i = 0; i < count; i++){
        let placed = false;
        
        // Intentos para encontrar hueco sin colisiÃ³n
        for (let t = 0; t < 150; t++){
          const angle = (i * step) + rand(-0.8, 0.8); 
          const r = rand(minR, maxR);

          let x = cx + Math.cos(angle) * r;
          let y = cy + Math.sin(angle) * r;

          x = clamp(x, marginX, w - marginX);
          y = clamp(y, marginTop, h - marginBottom);

          if (!isMobile) {
              const insideMain =
                x > ex.x0 && x < ex.x1 &&
                y > ex.y0 && y < ex.y1;
              if (insideMain) continue;
          }

          let overlap = false;
          for (const s of slots) {
              const dx = s.rawX - x;
              const dy = s.rawY - y;
              const dist = Math.sqrt(dx*dx + dy*dy);
              if (dist < minDist) {
                  overlap = true;
                  break;
              }
          }
          if (overlap) continue;

          slots.push({
            left: (x / w * 100).toFixed(2) + "vw",
            top:  (y / h * 100).toFixed(2) + "vh",
            rawX: x,
            rawY: y
          });

          placed = true;
          break;
        }

        if (!placed){
          const corners = [
            { left:"10vw", top:"20vh" },
            { left:"90vw", top:"20vh" },
            { left:"10vw", top:"80vh" },
            { left:"90vw", top:"80vh" },
          ];
          slots.push(corners[i % 4]);
        }
      }

      return slots;
    }

    function buildPolaroids(){
      polaroidsEl.innerHTML = "";

      // Only generate polaroids for images that aren't the initial main one?
      // Or duplicate them all as decoration? Let's use the list of indices excluding main for decoration
      // But if user clicks them, we want to jump to that image in carousel.
      
      let indices = [];
      if (USE_DEMO_IMAGES) {
        indices = Array.from({length: TOTAL_LOCAL}, (_, i) => i);
      } else {
        for (let i = 1; i <= TOTAL_LOCAL; i++) {
          if (i !== MAIN_BG_NUM) indices.push(i);
        }
      }
      
      indices.sort(() => Math.random() - 0.5);

      const slots = generateRingSlots(indices.length);

      indices.forEach((idxRef, i) => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "polaroid";

        const rot = rand(-16, 16).toFixed(2) + "deg";
        const delay = Math.floor(rand(60, 880)) + "ms";
        const floatDur = rand(4.8, 7.2).toFixed(2) + "s";
        const slot = slots[i % slots.length] || {left: '50%', top: '50%'};

        btn.style.setProperty("--rot", rot);
        btn.style.setProperty("--delay", delay);
        btn.style.setProperty("--floatDur", floatDur);
        btn.style.setProperty("--left", slot.left);
        btn.style.setProperty("--top", slot.top);
        
        btn.style.zIndex = String(20 + i);

        const imgSrc = getImageUrl(idxRef);
        const img = document.createElement("img");
        img.src = imgSrc;
        img.alt = `Foto recuerdo`;
        img.loading = (i < 6) ? "eager" : "lazy";
        img.decoding = "async";

        img.onerror = () => {
          img.src = ""; 
          img.style.background = "#eee";
        };

        const msg = greetings[i % greetings.length];

        const label = document.createElement("div");
        label.className = "label";
        label.innerHTML = `<span>${msg}</span><small>ðŸ’›</small>`;

        btn.setAttribute("aria-label", `${msg} (ver foto grande)`);

        btn.appendChild(img);
        btn.appendChild(label);

        // Click on polaroid: Find this image in the carousel list and jump to it
        btn.addEventListener("click", () => {
            playClickSound();
            
            // Find index in carousel
            const targetIdx = imageList.findIndex(item => item.src === imgSrc);
            if(targetIdx !== -1) {
                updateCarousel(targetIdx);
            } else {
                // Fallback (shouldn't happen)
                openLightbox(img.src, msg);
            }
        });
        
        btn.addEventListener("mouseenter", () => {
             btn.style.zIndex = "1000"; 
        });
        btn.addEventListener("mouseleave", () => {
             setTimeout(() => {
                 if(!btn.matches(':hover')) btn.style.zIndex = String(20 + i);
             }, 50);
        });

        polaroidsEl.appendChild(btn);
        
        setTimeout(() => btn.classList.add("show"), 50);
      });
    }

    // --- Audio Functions ---

    function toggleMusic(){
        if(bgMusic.paused){
            bgMusic.play().then(() => {
                isMusicPlaying = true;
                musicIcon.textContent = "ðŸ”Š";
                musicText.textContent = "Sonando";
            }).catch(e => console.log("Audio play failed (interaction needed)", e));
        } else {
            bgMusic.pause();
            isMusicPlaying = false;
            musicIcon.textContent = "ðŸ”‡";
            musicText.textContent = "Silencio";
        }
    }

    function playClickSound(){
        // Reiniciar el sonido para que se pueda tocar rÃ¡pido
        clickSound.currentTime = 0;
        clickSound.play().catch(e => {}); // Ignorar errores si no hay interacciÃ³n previa
    }

    // Intentar habilitar audio en la primera interacciÃ³n global (si no empezÃ³ con el botÃ³n de intro)
    function unlockAudio(){
        if(userInteracted) return;
        userInteracted = true;
        if(bgMusic.paused){
            toggleMusic(); 
        }
    }

    musicBtn.addEventListener("click", (e) => {
        e.stopPropagation(); 
        userInteracted = true;
        toggleMusic();
    });

    // --- Lightbox Functions ---

    function openLightbox(src, msg){
      lbImg.src = src;
      lbTitle.textContent = msg;
      lightbox.classList.add("show");
      lightbox.setAttribute("aria-hidden", "false");
      lbCloseBtn.focus({ preventScroll: true });
    }
    function closeLightbox(){
      lightbox.classList.remove("show");
      lightbox.setAttribute("aria-hidden", "true");
      setTimeout(() => { 
        if(!lightbox.classList.contains("show")) lbImg.src = ""; 
      }, 300);
    }

    lbCloseBtn.addEventListener("click", closeLightbox);
    lightbox.addEventListener("click", (e) => { 
      if (e.target === lightbox) closeLightbox(); 
    });
    document.addEventListener("keydown", (e) => { if (e.key === "Escape") closeLightbox(); });

    let resizeTimer = null;
    window.addEventListener("resize", () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(buildPolaroids, 200);
    });

    // --- INIT & INTRO LOGIC ---

    window.onload = () => {
        setupMainImages();
        setTimeout(buildPolaroids, 100);

        // INTRO Handling
        const video = document.getElementById('introVideo');
        const enterBtn = document.getElementById('enterBtn');
        const introLayer = document.getElementById('introLayer');

        // Intentar reproducir el video
        video.play().catch(err => {
            console.log("Autoplay bloqueado o error:", err);
            // Si el video falla al iniciar (ej. necesita interacciÃ³n), mostramos controles
            video.controls = true;
        });

        // Cuando el video termina, mostramos el botÃ³n
        video.addEventListener('ended', () => {
            enterBtn.classList.add('visible');
        });

        // Al clicar el botÃ³n de "Apachurrame"
        enterBtn.addEventListener('click', () => {
            // Desvanecer capa intro
            introLayer.style.opacity = '0';
            introLayer.style.pointerEvents = 'none';

            // Quitar del DOM despuÃ©s de la transiciÃ³n
            setTimeout(() => {
                introLayer.remove();
            }, 800);

            // Activar mÃºsica de fondo
            userInteracted = true; // Marcamos que el usuario interactuÃ³
            bgMusic.play().then(() => {
                isMusicPlaying = true;
                musicIcon.textContent = "ðŸ”Š";
                musicText.textContent = "Sonando";
            }).catch(e => console.log("Bg music blocked", e));
        });
    };

  </script>
</body>
</html>
